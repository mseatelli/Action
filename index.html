<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action! - TODO App Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #42a5f5;
            --primary-dark: #1e88e5;
            --bg-light: #e3f2fd;
        }
        
        [data-theme="blue"] { --primary: #42a5f5; --primary-dark: #1e88e5; }
        [data-theme="green"] { --primary: #66bb6a; --primary-dark: #43a047; }
        [data-theme="purple"] { --primary: #ab47bc; --primary-dark: #8e24aa; }
        [data-theme="orange"] { --primary: #ff9800; --primary-dark: #f57c00; }
        [data-theme="pink"] { --primary: #ec407a; --primary-dark: #d81b60; }
        [data-theme="teal"] { --primary: #26a69a; --primary-dark: #00897b; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #bbdefb 100%);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
        }

        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .splash-logo {
            width: 120px;
            height: 120px;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: pulse 2s infinite;
            font-size: 2.5rem;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .splash-title {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .splash-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .dark-mode .splash-subtitle { color: #ccc; }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(66,165,245,0.2);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .app { display: none; min-height: 100vh; }

        .header {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(66,165,245,0.3);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dark-mode .header { background: rgba(45,45,45,0.9); }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2rem;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.7rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover { background: var(--primary-dark); transform: scale(1.05); }

        .menu-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(66,165,245,0.3);
            min-width: 200px;
            z-index: 1000;
            display: none;
            margin-top: 0.5rem;
        }

        .dark-mode .menu-dropdown { background: rgba(45,45,45,0.95); }
        .menu-dropdown.show { display: block; }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            color: inherit;
            font-size: 1rem;
        }

        .menu-item:hover { background: rgba(66,165,245,0.1); }
        .menu-item:first-child { border-radius: 12px 12px 0 0; }
        .menu-item:last-child { border-radius: 0 0 12px 12px; }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 99;
            display: none;
        }

        .overlay.show { display: block; }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .page { display: none; }
        .page.active { display: block; }

        .card {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border: 1px solid rgba(66,165,245,0.2);
        }

        .dark-mode .card { background: rgba(45,45,45,0.8); }

        .page-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .input-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .input, .select {
            background: white;
            border: 2px solid rgba(66,165,245,0.3);
            border-radius: 12px;
            padding: 1rem;
            font-size: 1rem;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .dark-mode .input, .dark-mode .select {
            background: rgba(70,70,70,0.8);
            color: white;
        }

        .input:focus, .select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(66,165,245,0.1);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66,165,245,0.3);
        }

        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            background: var(--primary);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover { transform: scale(1.05); }
        .tag.selected {
            background: var(--primary-dark);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .task-item {
            background: rgba(255,255,255,0.9);
            border: 1px solid rgba(66,165,245,0.2);
            border-radius: 12px;
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }

        .dark-mode .task-item { background: rgba(60,60,60,0.8); }
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(66,165,245,0.2);
        }

        .task-item.recurring::before {
            content: 'üîÑ';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.9rem;
        }

        .task-content { flex: 1; }

        .task-text {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .task-meta {
            font-size: 0.9rem;
            color: #666;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }

        .dark-mode .task-meta { color: #bbb; }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .btn-success { color: #66bb6a; }
        .btn-success:hover { background: rgba(76,175,80,0.1); }
        .btn-danger { color: #ef5350; }
        .btn-danger:hover { background: rgba(244,67,54,0.1); }
        .btn-warning { color: #ffa726; }
        .btn-warning:hover { background: rgba(255,152,0,0.1); }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            border-left: 4px solid var(--primary);
            z-index: 1000;
            max-width: 300px;
        }

        .dark-mode .notification { background: rgba(45,45,45,0.95); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: rgba(255,255,255,0.95);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .dark-mode .modal-content { background: rgba(45,45,45,0.95); }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }

        .pomodoro-timer { text-align: center; padding: 2rem; }

        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--primary);
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .timer-mode {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .mode-btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: var(--primary);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .theme-option {
            aspect-ratio: 1;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .theme-option:hover { transform: scale(1.05); }
        .theme-option.active {
            border-color: white;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .theme-color-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .dark-mode .empty-state { color: #aaa; }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 640px) {
            .input-group { flex-direction: column; }
            .input, .select { min-width: auto; }
            .task-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            .task-actions { align-self: flex-end; }
            .timer-display { font-size: 3rem; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-theme="blue">
    <div id="splashScreen" class="splash-screen">
        <div class="splash-logo">‚úì</div>
        <h1 class="splash-title">Action!</h1>
        <p class="splash-subtitle">Votre assistant personnel de productivit√©</p>
        <div class="spinner"></div>
    </div>

    <div id="app" class="app">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">‚úì</div>
                    <h1 class="logo-text">Action!</h1>
                </div>
                <div class="header-buttons">
                    <button id="pomodoroBtn" class="btn">‚è±Ô∏è</button>
                    <button id="themeToggle" class="btn">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <div style="position: relative;">
                        <button id="menuToggle" class="btn">‚ò∞</button>
                        <div id="menuDropdown" class="menu-dropdown">
                            <button class="menu-item" data-page="tasks">
                                <span>üè†</span> Mes t√¢ches
                            </button>
                            <button class="menu-item" data-page="statistics">
                                <span>üìä</span> Statistiques
                            </button>
                            <button class="menu-item" data-page="history">
                                <span>‚úÖ</span> Historique
                            </button>
                            <button class="menu-item" data-page="settings">
                                <span>‚öôÔ∏è</span> Param√®tres
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div id="overlay" class="overlay"></div>

        <main class="main">
            <div id="tasksPage" class="page active">
                <div class="card">
                    <h2 class="page-title"><span>üìù</span> Mes t√¢ches</h2>
                    
                    <div class="tags-container" id="filterTags">
                        <div class="tag" data-tag="all">üìå Toutes</div>
                    </div>

                    <div class="input-group">
                        <input type="text" id="newTaskInput" class="input" placeholder="Nouvelle t√¢che...">
                        <input type="date" id="taskDate" class="input" style="flex: none; width: auto;">
                        <select id="taskCategory" class="select" style="flex: none; width: auto;">
                            <option value="">üìÅ Cat√©gorie</option>
                            <option value="travail">üíº Travail</option>
                            <option value="personnel">üè† Personnel</option>
                            <option value="courses">üõí Courses</option>
                            <option value="sante">üíä Sant√©</option>
                            <option value="sport">üèÉ Sport</option>
                            <option value="autre">üìå Autre</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <select id="taskPriority" class="select" style="flex: none; width: auto;">
                            <option value="normale">‚ö™ Normale</option>
                            <option value="haute">üî¥ Haute</option>
                            <option value="basse">üîµ Basse</option>
                        </select>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0 1rem;">
                            <input type="checkbox" id="taskRecurring">
                            <span>üîÑ R√©currente</span>
                        </label>
                        <select id="taskRecurringInterval" class="select" style="flex: none; width: auto; display: none;">
                            <option value="daily">Quotidienne</option>
                            <option value="weekly">Hebdomadaire</option>
                            <option value="monthly">Mensuelle</option>
                        </select>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0 1rem;">
                            <input type="checkbox" id="taskNotification">
                            <span>üîî Rappel</span>
                        </label>
                        <button id="addTaskBtn" class="btn-primary">
                            <span>‚ûï</span> Ajouter
                        </button>
                    </div>

                    <div style="position: relative; margin-bottom: 2rem;">
                        <input type="text" id="searchInput" class="input" placeholder="üîç Rechercher une t√¢che..." style="padding-left: 3rem;">
                    </div>

                    <div id="taskList" class="task-list">
                        <div class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <p>Aucune t√¢che pour le moment.<br>Ajoutez-en une !</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="statisticsPage" class="page">
                <div class="card">
                    <h2 class="page-title"><span>üìä</span> Statistiques</h2>
                    <div class="stats-grid" id="statsGrid"></div>
                    <div id="statsChart" style="margin-top: 2rem;"></div>
                </div>
            </div>

            <div id="historyPage" class="page">
                <div class="card">
                    <h2 class="page-title"><span>‚úÖ</span> Historique (<span id="historyCount">0</span>)</h2>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button onclick="exportData()" class="btn-primary" style="background: #4caf50; font-size: 0.9rem; padding: 0.8rem 1.2rem;">
                                <span>üíæ</span> Exporter
                            </button>
                            <label class="btn-primary" style="background: #ff9800; cursor: pointer; font-size: 0.9rem; padding: 0.8rem 1.2rem;">
                                <span>üìÅ</span> Importer
                                <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                            </label>
                            <button onclick="clearAllData()" class="btn-primary" style="background: #9c27b0; font-size: 0.9rem; padding: 0.8rem 1.2rem;">
                                <span>üóëÔ∏è</span> Tout effacer
                            </button>
                        </div>
                        
                        <button id="clearHistoryBtn" class="btn-primary" style="background: #f44336; font-size: 0.9rem; padding: 0.8rem 1.2rem;">
                            <span>üóëÔ∏è</span> Effacer historique
                        </button>
                    </div>

                    <div id="historyList">
                        <div class="empty-state">
                            <div class="empty-icon">üìä</div>
                            <p>Aucune t√¢che termin√©e</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settingsPage" class="page">
                <div class="card">
                    <h2 class="page-title"><span>‚öôÔ∏è</span> Param√®tres</h2>
                    
                    <h3 style="margin-bottom: 1rem; color: var(--primary);">üé® Th√®me de couleur</h3>
                    <div class="theme-selector">
                        <div class="theme-option active" data-theme="blue">
                            <div class="theme-color-circle" style="background: #42a5f5;"></div>
                            <span>Bleu</span>
                        </div>
                        <div class="theme-option" data-theme="green">
                            <div class="theme-color-circle" style="background: #66bb6a;"></div>
                            <span>Vert</span>
                        </div>
                        <div class="theme-option" data-theme="purple">
                            <div class="theme-color-circle" style="background: #ab47bc;"></div>
                            <span>Violet</span>
                        </div>
                        <div class="theme-option" data-theme="orange">
                            <div class="theme-color-circle" style="background: #ff9800;"></div>
                            <span>Orange</span>
                        </div>
                        <div class="theme-option" data-theme="pink">
                            <div class="theme-color-circle" style="background: #ec407a;"></div>
                            <span>Rose</span>
                        </div>
                        <div class="theme-option" data-theme="teal">
                            <div class="theme-color-circle" style="background: #26a69a;"></div>
                            <span>Turquoise</span>
                        </div>
                    </div>

                    <hr style="margin: 2rem 0; border: none; border-top: 1px solid rgba(0,0,0,0.1);">

                    <h3 style="margin-bottom: 1rem; color: var(--primary);">üîî Notifications</h3>
                    <label style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(66,165,245,0.1); border-radius: 8px; cursor: pointer;">
                        <input type="checkbox" id="enableNotifications" style="width: 20px; height: 20px;">
                        <span>Activer les notifications de rappel</span>
                    </label>

                    <hr style="margin: 2rem 0; border: none; border-top: 1px solid rgba(0,0,0,0.1);">

                    <h3 style="margin-bottom: 1rem; color: var(--primary);">üì± Application</h3>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button onclick="showInfo()" class="btn-primary" style="background: #2196f3;">
                            <span>‚ÑπÔ∏è</span> √Ä propos
                        </button>
                        <button onclick="requestNotificationPermission()" class="btn-primary" style="background: #ff9800;">
                            <span>üîî</span> Autoriser les notifications
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="pomodoroModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚è±Ô∏è Pomodoro Focus</h2>
                <button class="modal-close" onclick="closePomodoroModal()">‚úï</button>
            </div>
            
            <div class="pomodoro-timer">
                <div class="timer-mode">
                    <button class="mode-btn active" data-mode="work">Travail (25 min)</button>
                    <button class="mode-btn" data-mode="break">Pause (5 min)</button>
                    <button class="mode-btn" data-mode="longbreak">Pause longue (15 min)</button>
                </div>

                <div class="timer-display" id="timerDisplay">25:00</div>

                <div style="text-align: center; margin-bottom: 1rem;">
                    <p id="timerStatus" style="color: #666;">Pr√™t √† commencer</p>
                </div>

                <div class="timer-controls">
                    <button id="timerStart" class="btn-primary" style="font-size: 1.2rem; padding: 1.2rem 2rem;">
                        ‚ñ∂Ô∏è D√©marrer
                    </button>
                    <button id="timerPause" class="btn-primary" style="background: #ff9800; font-size: 1.2rem; padding: 1.2rem 2rem; display: none;">
                        ‚è∏Ô∏è Pause
                    </button>
                    <button id="timerReset" class="btn-primary" style="background: #f44336; font-size: 1.2rem; padding: 1.2rem 2rem;">
                        üîÑ Reset
                    </button>
                </div>

                <div style="margin-top: 2rem; text-align: center;">
                    <p style="font-size: 0.9rem; color: #666;">
                        Sessions compl√©t√©es aujourd'hui: <strong id="sessionsToday">0</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let tasks = [];
        let completedTasks = [];
        let currentPage = 'tasks';
        let darkMode = false;
        let currentTheme = 'blue';
        let currentFilter = 'all';
        let notificationsEnabled = false;
        let pomodoroMode = 'work';
        let pomodoroMinutes = 25;
        let pomodoroSeconds = 0;
        let pomodoroTimer = null;
        let pomodoroRunning = false;
        let pomodoroSessionsToday = 0;

        function saveData() {
            try {
                const data = {
                    tasks, completedTasks, darkMode, currentTheme, 
                    notificationsEnabled, pomodoroSessionsToday,
                    version: '2.0'
                };
                localStorage.setItem('actionApp_data', JSON.stringify(data));
            } catch (e) { console.error('Erreur sauvegarde:', e); }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('actionApp_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    tasks = data.tasks || [];
                    completedTasks = data.completedTasks || [];
                    darkMode = data.darkMode || false;
                    currentTheme = data.currentTheme || 'blue';
                    notificationsEnabled = data.notificationsEnabled || false;
                    pomodoroSessionsToday = data.pomodoroSessionsToday || 0;
                    
                    tasks.forEach(t => {
                        if (t.createdAt) t.createdAt = new Date(t.createdAt);
                    });
                    completedTasks.forEach(t => {
                        if (t.createdAt) t.createdAt = new Date(t.createdAt);
                        if (t.completedAt) t.completedAt = new Date(t.completedAt);
                    });
                    return true;
                }
            } catch (e) { console.error('Erreur chargement:', e); }
            return false;
        }

        function exportData() {
            try {
                const data = { tasks, completedTasks, exportDate: new Date().toISOString() };
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `action_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                showNotification('‚úÖ Sauvegarde export√©e !');
            } catch (e) {
                showNotification('‚ùå Erreur export', 'error');
            }
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm(`Importer ${data.tasks?.length || 0} t√¢ches ?`)) {
                        tasks = data.tasks || [];
                        completedTasks = data.completedTasks || [];
                        saveData();
                        renderAll();
                        showNotification('‚úÖ Donn√©es import√©es !');
                    }
                } catch (e) {
                    showNotification('‚ùå Fichier invalide', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è Supprimer TOUTES vos donn√©es ?')) {
                localStorage.removeItem('actionApp_data');
                tasks = [];
                completedTasks = [];
                renderAll();
                showNotification('üóëÔ∏è Donn√©es supprim√©es');
            }
        }

        function addTask() {
            const text = document.getElementById('newTaskInput').value.trim();
            const date = document.getElementById('taskDate').value;
            const category = document.getElementById('taskCategory').value || 'autre';
            const priority = document.getElementById('taskPriority').value;
            const recurring = document.getElementById('taskRecurring').checked;
            const interval = document.getElementById('taskRecurringInterval').value;
            const notification = document.getElementById('taskNotification').checked;
            
            if (!text) return showNotification('‚ö†Ô∏è Texte requis', 'warning');

            tasks.push({
                id: Date.now(),
                text, date, category, priority,
                recurring, recurringInterval: recurring ? interval : null,
                notification, completed: false, createdAt: new Date()
            });

            document.getElementById('newTaskInput').value = '';
            document.getElementById('taskCategory').value = '';
            saveData();
            renderTasks();
            updateStats();
            showNotification('‚úÖ T√¢che ajout√©e !');
        }

        function deleteTask(id) {
            if (confirm('Supprimer ?')) {
                tasks = tasks.filter(t => t.id !== id);
                saveData();
                renderTasks();
                updateStats();
            }
        }

        function completeTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;

            if (task.recurring) {
                const next = new Date(task.date);
                if (task.recurringInterval === 'daily') next.setDate(next.getDate() + 1);
                else if (task.recurringInterval === 'weekly') next.setDate(next.getDate() + 7);
                else if (task.recurringInterval === 'monthly') next.setMonth(next.getMonth() + 1);
                
                tasks.push({...task, id: Date.now(), date: next.toISOString().split('T')[0]});
            }

            completedTasks.push({...task, completed: true, completedAt: new Date()});
            tasks = tasks.filter(t => t.id !== id);
            
            saveData();
            renderTasks();
            renderHistory();
            updateStats();
            showNotification('‚úÖ Termin√©e !');
        }

        function getCategoryEmoji(cat) {
            const emojis = {travail:'üíº', personnel:'üè†', courses:'üõí', sante:'üíä', sport:'üèÉ', autre:'üìå'};
            return emojis[cat] || 'üìå';
        }

        function getPriorityColor(p) {
            return p === 'haute' ? '#ef5350' : p === 'basse' ? '#66bb6a' : '#42a5f5';
        }

        function renderTasks() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            let filtered = tasks.filter(t => t.text.toLowerCase().includes(search));
            if (currentFilter !== 'all') filtered = filtered.filter(t => t.category === currentFilter);

            const list = document.getElementById('taskList');
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìù</div><p>Aucune t√¢che</p></div>';
                return;
            }

            filtered.sort((a,b) => {
                const pOrder = {haute:0, normale:1, basse:2};
                return pOrder[a.priority] - pOrder[b.priority] || new Date(a.date) - new Date(b.date);
            });

            list.innerHTML = filtered.map(t => `
                <div class="task-item ${t.recurring?'recurring':''}" style="border-left: 4px solid ${getPriorityColor(t.priority)}">
                    <div class="task-content">
                        <div class="task-text">${t.text}</div>
                        <div class="task-meta">
                            <span>${getCategoryEmoji(t.category)} ${t.category}</span>
                            <span>üìÖ ${new Date(t.date).toLocaleDateString('fr-FR')}</span>
                            ${t.recurring ? '<span>üîÑ R√©currente</span>' : ''}
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn-icon btn-success" onclick="completeTask(${t.id})">‚úì</button>
                        <button class="btn-icon btn-danger" onclick="deleteTask(${t.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');

            renderFilterTags();
        }

        function renderFilterTags() {
            const cats = ['all', ...new Set(tasks.map(t => t.category))];
            document.getElementById('filterTags').innerHTML = cats.map(c => {
                const emoji = c === 'all' ? 'üìå' : getCategoryEmoji(c);
                const label = c === 'all' ? 'Toutes' : c;
                const count = c === 'all' ? tasks.length : tasks.filter(t => t.category === c).length;
                return `<div class="tag ${currentFilter === c ? 'selected' : ''}" onclick="filterByTag('${c}')">${emoji} ${label} (${count})</div>`;
            }).join('');
        }

        function filterByTag(tag) {
            currentFilter = tag;
            renderTasks();
        }

        function renderHistory() {
            document.getElementById('historyCount').textContent = completedTasks.length;
            const list = document.getElementById('historyList');
            
            if (completedTasks.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìä</div><p>Aucune t√¢che termin√©e</p></div>';
                return;
            }

            const sorted = [...completedTasks].sort((a,b) => new Date(b.completedAt) - new Date(a.completedAt));
            list.innerHTML = sorted.map(t => `
                <div class="task-item" style="background: rgba(76,175,80,0.1); border-left: 4px solid #66bb6a;">
                    <div class="task-content">
                        <div class="task-text" style="text-decoration: line-through; opacity: 0.8;">‚úì ${t.text}</div>
                        <div class="task-meta">
                            <span>${getCategoryEmoji(t.category)} ${t.category}</span>
                            <span>‚úÖ ${new Date(t.completedAt).toLocaleDateString('fr-FR')}</span>
                        </div>
                    </div>
                    <button class="btn-icon btn-danger" onclick="deleteFromHistory(${t.id})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function deleteFromHistory(id) {
            if (confirm('Supprimer de l\'historique ?')) {
                completedTasks = completedTasks.filter(t => t.id !== id);
                saveData();
                renderHistory();
                updateStats();
            }
        }

        function clearHistory() {
            if (confirm('Effacer tout l\'historique ?')) {
                completedTasks = [];
                saveData();
                renderHistory();
                updateStats();
            }
        }

        function updateStats() {
            const total = tasks.length + completedTasks.length;
            const rate = total > 0 ? Math.round((completedTasks.length / total) * 100) : 0;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const thisWeek = completedTasks.filter(t => new Date(t.completedAt) > weekAgo).length;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${tasks.length}</div>
                    <div class="stat-label">En cours</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #66bb6a, #43a047);">
                    <div class="stat-value">${completedTasks.length}</div>
                    <div class="stat-label">Termin√©es</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ff9800, #f57c00);">
                    <div class="stat-value">${rate}%</div>
                    <div class="stat-label">Completion</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ab47bc, #8e24aa);">
                    <div class="stat-value">${thisWeek}</div>
                    <div class="stat-label">Cette semaine</div>
                </div>
            `;

            const cats = {};
            [...tasks, ...completedTasks].forEach(t => cats[t.category] = (cats[t.category]||0) + 1);
            
            let chart = '<div style="padding: 2rem; background: rgba(66,165,245,0.1); border-radius: 12px;"><h3 style="margin-bottom: 1rem; color: var(--primary);">üìä Par cat√©gorie</h3>';
            for (const [cat, count] of Object.entries(cats)) {
                const pct = Math.round((count / total) * 100);
                chart += `
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>${getCategoryEmoji(cat)} ${cat}</span>
                            <span><strong>${count}</strong> (${pct}%)</span>
                        </div>
                        <div style="background: rgba(0,0,0,0.1); height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: var(--primary); height: 100%; width: ${pct}%; transition: width 0.5s;"></div>
                        </div>
                    </div>
                `;
            }
            chart += '</div>';
            document.getElementById('statsChart').innerHTML = chart;
        }

        function openPomodoroModal() {
            document.getElementById('pomodoroModal').classList.add('show');
            updateTimerDisplay();
        }

        function closePomodoroModal() {
            document.getElementById('pomodoroModal').classList.remove('show');
            if (pomodoroRunning) pausePomodoro();
        }

        function setPomodoroMode(mode) {
            pomodoroMode = mode;
            pomodoroMinutes = mode === 'work' ? 25 : mode === 'break' ? 5 : 15;
            pomodoroSeconds = 0;
            updateTimerDisplay();
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active');
                if (b.dataset.mode === mode) b.classList.add('active');
            });
        }

        function startPomodoro() {
            if (pomodoroRunning) return;
            pomodoroRunning = true;
            document.getElementById('timerStart').style.display = 'none';
            document.getElementById('timerPause').style.display = 'inline-flex';
            document.getElementById('timerStatus').textContent = 'üéØ Concentrez-vous !';
            
            pomodoroTimer = setInterval(() => {
                if (pomodoroSeconds === 0) {
                    if (pomodoroMinutes === 0) {
                        finishPomodoro();
                        return;
                    }
                    pomodoroMinutes--;
                    pomodoroSeconds = 59;
                } else {
                    pomodoroSeconds--;
                }
                updateTimerDisplay();
            }, 1000);
        }

        function pausePomodoro() {
            pomodoroRunning = false;
            clearInterval(pomodoroTimer);
            document.getElementById('timerStart').style.display = 'inline-flex';
            document.getElementById('timerPause').style.display = 'none';
            document.getElementById('timerStatus').textContent = '‚è∏Ô∏è En pause';
        }

        function resetPomodoro() {
            pomodoroRunning = false;
            clearInterval(pomodoroTimer);
            setPomodoroMode(pomodoroMode);
            document.getElementById('timerStart').style.display = 'inline-flex';
            document.getElementById('timerPause').style.display = 'none';
            document.getElementById('timerStatus').textContent = 'Pr√™t √† commencer';
        }

        function finishPomodoro() {
            pomodoroRunning = false;
            clearInterval(pomodoroTimer);
            if (pomodoroMode === 'work') {
                pomodoroSessionsToday++;
                document.getElementById('sessionsToday').textContent = pomodoroSessionsToday;
                saveData();
                showNotification('üéâ Session termin√©e !');
            }
            document.getElementById('timerStart').style.display = 'inline-flex';
            document.getElementById('timerPause').style.display = 'none';
            document.getElementById('timerStatus').textContent = '‚úÖ Termin√© !';
            resetPomodoro();
        }

        function updateTimerDisplay() {
            const m = String(pomodoroMinutes).padStart(2, '0');
            const s = String(pomodoroSeconds).padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `${m}:${s}`;
        }

        function showNotification(msg, type = 'success') {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = msg;
            if (type === 'error') notif.style.borderLeftColor = '#ef5350';
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(p => {
                    if (p === 'granted') {
                        showNotification('‚úÖ Notifications activ√©es !');
                        notificationsEnabled = true;
                        document.getElementById('enableNotifications').checked = true;
                        saveData();
                    }
                });
            }
        }

        function setTheme(theme) {
            currentTheme = theme;
            document.body.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-option').forEach(o => {
                o.classList.remove('active');
                if (o.dataset.theme === theme) o.classList.add('active');
            });
            saveData();
            showNotification('üé® Th√®me appliqu√© !');
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            applyTheme();
            saveData();
        }

        function applyTheme() {
            document.body.classList.toggle('dark-mode', darkMode);
            document.getElementById('themeIcon').textContent = darkMode ? '‚òÄÔ∏è' : 'üåô';
        }

        function showPage(page) {
            currentPage = page;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page + 'Page').classList.add('active');
            if (page === 'statistics') updateStats();
            else if (page === 'history') renderHistory();
        }

        function toggleMenu() {
            document.getElementById('menuDropdown').classList.toggle('show');
            document.getElementById('overlay').classList.toggle('show');
        }

        function closeMenu() {
            document.getElementById('menuDropdown').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        function showInfo() {
            alert('Action! - TODO App Pro v2.0\n\n‚ú® Gestion compl√®te des t√¢ches\nüìä Statistiques\n‚è±Ô∏è Timer Pomodoro\nüé® 6 th√®mes\nüíæ Export/Import\n\nCr√©√© avec ‚ù§Ô∏è');
        }

        function renderAll() {
            renderTasks();
            renderHistory();
            updateStats();
            applyTheme();
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setTimeout(() => {
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                renderAll();
                document.getElementById('sessionsToday').textContent = pomodoroSessionsToday;
            }, 3000);

            document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('addTaskBtn').addEventListener('click', addTask);
            document.getElementById('newTaskInput').addEventListener('keypress', e => e.key === 'Enter' && addTask());
            document.getElementById('searchInput').addEventListener('input', renderTasks);
            document.getElementById('taskRecurring').addEventListener('change', e => {
                document.getElementById('taskRecurringInterval').style.display = e.target.checked ? 'block' : 'none';
            });
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
            document.getElementById('menuToggle').addEventListener('click', toggleMenu);
            document.getElementById('overlay').addEventListener('click', closeMenu);
            
            document.querySelectorAll('.menu-item').forEach(i => {
                i.addEventListener('click', e => {
                    showPage(e.currentTarget.dataset.page);
                    closeMenu();
                });
            });

            document.getElementById('pomodoroBtn').addEventListener('click', openPomodoroModal);
            document.getElementById('timerStart').addEventListener('click', startPomodoro);
            document.getElementById('timerPause').addEventListener('click', pausePomodoro);
            document.getElementById('timerReset').addEventListener('click', resetPomodoro);
            
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.addEventListener('click', e => {
                    resetPomodoro();
                    setPomodoroMode(e.target.dataset.mode);
                });
            });

            document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);

            document.querySelectorAll('.theme-option').forEach(o => {
                o.addEventListener('click', e => setTheme(e.currentTarget.dataset.theme));
            });

            document.getElementById('enableNotifications').addEventListener('change', e => {
                notificationsEnabled = e.target.checked;
                saveData();
            });

            document.getElementById('pomodoroModal').addEventListener('click', e => {
                if (e.target.id === 'pomodoroModal') closePomodoroModal();
            });
        });

        setInterval(() => {
            if (tasks.length > 0 || completedTasks.length > 0) saveData();
        }, 30000);

        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>